(function(){var t,n=function(t,n){return function(){return t.apply(n,arguments)}};t=function(){function t(t,e,r,c,o,i){this.cli_path=t,this.status_cb=r,this.cli_onmessage=c,this.cli_onopen=o,this.cli_onclose=i,this.on_close=n(this.on_close,this),this.on_open=n(this.on_open,this),this.send=n(this.send,this),this.reconnect_try=n(this.reconnect_try,this),this.reconnect_reset=n(this.reconnect_reset,this),this.connect=n(this.connect,this),this.update_status=n(this.update_status,this),$.extend(this.reconnect,e)}return t.prototype.reconnect={reconnecting:!1,do_not_reconnect:!1,reload_after_n:!0,max_retries:30,reset_mult:6,retry_timeout_ms:1500+Math.floor(60*Math.random()),retry_multiplier:2,retry_curr_multiplier:0,retry_curr_timeout:0,retry_count:0},t.prototype.conn=null,t.prototype.update_status=function(){if(this.reconnect.reconnecting){if(null!=this.status_cb)return this.status_cb("reconnecting")}else if(null===this.conn||this.conn.readyState!==SockJS.OPEN){if(null!=this.status_cb)return this.status_cb("disconnected")}else if(null!=this.status_cb)return this.status_cb("connected")},t.prototype.connect=function(){return null!=this.conn&&(this.conn.close(),this.conn=null),this.conn=new SockJS(this.cli_path),null!=this.status_cb&&this.status_cb("connecting"),this.conn.onopen=this.on_open,this.conn.onclose=this.on_close,this.conn.onmessage=this.cli_onmessage},t.prototype.reconnect_reset=function(){return this.reconnect.reconnecting=!1,this.reconnect.retry_curr_timeout=0,this.reconnect.retry_curr_multipler=0,this.reconnect.retry_count=0},t.prototype.reconnect_try=function(t){var n=this;return this.reconnect.retry_count!==this.reconnect.max_retries?this.reconnect.reconnecting?(this.reconnect.retry_count+=1,setTimeout(function(){return n.reconnect.retry_curr_timeout*=n.reconnect.retry_multiplier,n.reconnect.retry_curr_multipler+=1,n.reconnect.retry_curr_multipler===n.reconnect.reset_mult&&(n.reconnect.retry_curr_timeout=n.reconnect.retry_timeout_ms,n.reconnect.retry_curr_multipler=1),t()},this.reconnect.retry_curr_timeout)):(this.reconnect.reconnecting=!0,this.reconnect.retry_curr_timeout=this.reconnect.retry_timeout_ms,this.reconnect.retry_curr_multipler=1,this.reconnect.retry_count=1,t()):(this.reconnect.reconnecting=!1,void(this.reconnect.reload_after_n&&window.location.reload(!0)))},t.prototype.send=function(t){return this.conn.send(t)},t.prototype.on_open=function(){return this.reconnect_reset(),this.update_status(),null!=this.cli_onopen?this.cli_onopen():void 0},t.prototype.on_close=function(){return this.conn=null,this.update_status(),null!=this.cli_onclose&&this.cli_onclose(),this.reconnect.do_not_reconnect?void 0:this.reconnect_try(this.connect)},t}(),("undefined"!=typeof exports&&null!==exports?exports:this).SockReconnect=t}).call(this);