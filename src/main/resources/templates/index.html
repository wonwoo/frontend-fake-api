<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>HOME</title>

    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" />
    <script th:src="@{/js/jquery-3.1.1.min.js}"></script>
    <script th:src="@{/js/json.js}"></script>
    <script th:src="@{/js/bootstrap.min.js}"></script>

    <style>
        .table td, th {
            text-align: center;
        }
        .ace-jsoneditor .ace_gutter {	background: #ebebeb;	color: #333	}		.ace-jsoneditor.ace_editor {	font-family: droid sans mono, consolas, monospace, courier new, courier, sans-serif;	line-height: 1.3;	}	.ace-jsoneditor .ace_print-margin {	width: 1px;	background: #e8e8e8	}	.ace-jsoneditor .ace_scroller {	background-color: #FFFFFF	}	.ace-jsoneditor .ace_text-layer {	color: gray	}	.ace-jsoneditor .ace_variable {	color: #1a1a1a	}	.ace-jsoneditor .ace_cursor {	border-left: 2px solid #000000	}	.ace-jsoneditor .ace_overwrite-cursors .ace_cursor {	border-left: 0px;	border-bottom: 1px solid #000000	}	.ace-jsoneditor .ace_marker-layer .ace_selection {	background: lightgray	}	.ace-jsoneditor.ace_multiselect .ace_selection.ace_start {	box-shadow: 0 0 3px 0px #FFFFFF;	border-radius: 2px	}	.ace-jsoneditor .ace_marker-layer .ace_step {	background: rgb(255, 255, 0)	}	.ace-jsoneditor .ace_marker-layer .ace_bracket {	margin: -1px 0 0 -1px;	border: 1px solid #BFBFBF	}	.ace-jsoneditor .ace_marker-layer .ace_active-line {	background: #FFFBD1	}	.ace-jsoneditor .ace_gutter-active-line {	background-color : #dcdcdc	}	.ace-jsoneditor .ace_marker-layer .ace_selected-word {	border: 1px solid lightgray	}	.ace-jsoneditor .ace_invisible {	color: #BFBFBF	}	.ace-jsoneditor .ace_keyword,	.ace-jsoneditor .ace_meta,	.ace-jsoneditor .ace_support.ace_constant.ace_property-value {	color: #AF956F	}	.ace-jsoneditor .ace_keyword.ace_operator {	color: #484848	}	.ace-jsoneditor .ace_keyword.ace_other.ace_unit {	color: #96DC5F	}	.ace-jsoneditor .ace_constant.ace_language {	color: darkorange	}	.ace-jsoneditor .ace_constant.ace_numeric {	color: red	}	.ace-jsoneditor .ace_constant.ace_character.ace_entity {	color: #BF78CC	}	.ace-jsoneditor .ace_invalid {	color: #FFFFFF;	background-color: #FF002A;	}	.ace-jsoneditor .ace_fold {	background-color: #AF956F;	border-color: #000000	}	.ace-jsoneditor .ace_storage,	.ace-jsoneditor .ace_support.ace_class,	.ace-jsoneditor .ace_support.ace_function,	.ace-jsoneditor .ace_support.ace_other,	.ace-jsoneditor .ace_support.ace_type {	color: #C52727	}	.ace-jsoneditor .ace_string {	color: green	}	.ace-jsoneditor .ace_comment {	color: #BCC8BA	}	.ace-jsoneditor .ace_entity.ace_name.ace_tag,	.ace-jsoneditor .ace_entity.ace_other.ace_attribute-name {	color: #606060	}	.ace-jsoneditor .ace_markup.ace_underline {	text-decoration: underline	}	.ace-jsoneditor .ace_indent-guide {	background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y	}
    </style>
</head>
<body>

<div class="container">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Fake</a>
            </div>
        </div>
    </nav>
    <button type="button" class="btn btn-info btn-lg pull-right" data-toggle="modal" data-target="#fakeModal">add</button>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Path</th>
            <th>Method</th>
            <th>Status Code</th>
            <th>Status</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="fake,i : ${fakes}">
            <th th:text="${fake.uri}"></th>
            <td th:switch="${fake.method.name()}">
                <span th:case="'GET'" th:text="${fake.method}" class="label label-primary"></span>
                <span th:case="'POST'" th:text="${fake.method}" class="label label-success"></span>
                <span th:case="'PUT'" th:text="${fake.method}" class="label label-info"></span>
                <span th:case="'PATCH'" th:text="${fake.method}" class="label label-warning"></span>
                <span th:case="'DELETE'" th:text="${fake.method}" class="label label-danger"></span>
            </td>
            <td th:switch="${#strings.substring(fake.statusCode.value(),0, 1)}">
                <span th:case="'2'" th:text="${fake.statusCode.value()}" class="label label-primary"></span>
                <span th:case="'4'" th:text="${fake.statusCode.value()}" class="label label-warning"></span>
                <span th:case="'5'" th:text="${fake.statusCode.value()}" class="label label-danger"></span>
            </td>
            <td th:text="${fake.statusCode.name()}"></td>
            <td><button type="button" th:onclick="'editViewer(\'' + ${fake.id} + '\');'" class="btn btn-warning" data-toggle="modal" data-target="#fakeModal">Edit</button></td>
            <td><button type="button" th:onclick="'deleteConfirm(\'' + ${fake.id} + '\');'" class="btn btn-danger">Delete</button></td>
        </tr>
        </tbody>
    </table>
</div>

<div id="fakeModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="uri">Path</label>
                    <input type="text" id="uri" name="uri" class="form-control" placeholder="/foo">
                </div>
                <div class="form-group">
                    <label for="method">Method</label>
                    <select class="form-control" id="method" name="method">
                        <option th:value="GET">GET</option>
                        <option th:value="POST">POST</option>
                        <option th:value="PUT">PUT</option>
                        <option th:value="PATCH">PATCH</option>
                        <option th:value="DELETE">DELETE</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="statusCode">Status Code</label>
                    <select class="form-control" id="statusCode" name="statusCode">
                        <option th:value="OK">200</option>
                        <option th:value="CREATED">201</option>
                        <option th:value="NO_CONTENT">204</option>
                        <option th:value="BAD_REQUEST">400</option>
                        <option th:value="UNAUTHORIZED">401</option>
                        <option th:value="FORBIDDEN">403</option>
                        <option th:value="NOT_FOUND">404</option>
                        <option th:value="INTERNAL_SERVER_ERROR">500</option>
                    </select>
                </div>
                <div class="form-group ace_editor ace-jsoneditor">
                    <label for="data">Response </label>
                    <button type="button" th:onclick="'format()'" class="btn btn-default" aria-label="Left Align">
                        <span class="glyphicon glyphicon-align-left" aria-hidden="true"></span>
                    </button>
                    <textarea class="form-control" id="data" name="data" rows="10"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <input type="button" class="btn btn-info" th:onclick="'save()'" value="Submit">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
            <input type="hidden" id="id">
        </div>
    </div>
</div>
</body>
<script>

    $('#fakeModal').on('hidden.bs.modal', function () {
        clear();
    });

    var _delete = function(id) {
        request('/fakes/'+id, 'DELETE',function(data) {
            window.location.reload();
        });
    }
    var deleteConfirm = function(id) {
        if (confirm("정말 삭제하시겠습니까??") == true) {
            _delete(id)
        } else {
            return;
        }
    };

    var clear = function() {
        $("#id").val("");
        $("#uri").val("");
        $("#data").val("");
        $("#method").val("");
        $("#statusCode").val("");
    };

    var editViewer = function (id) {
        $.get("/" + id, function(response) {
            $("#id").val(response.id);
            $("#uri").val(response.uri);
            $("#data").val(FormatTextarea(response.data));
            $("#method").val(response.method);
            $("#statusCode").val(response.statusCode);
        });
    };

    var save = function() {
        var id = $("#id").val();
        var uri = $("#uri").val();
        var data = $("#data").val();
        var method = $("#method").val();
        var statusCode = $("#statusCode").val();

        if(uri == "" || data == "" || method == "" || statusCode == "") {
            alert("필수 값을 입력해주세요!!");
            return;
        }

        var json = JSON.stringify({
            "uri": uri,
            "data": data,
            "method": method,
            "statusCode": statusCode
        });

        if(id == "") {
            request('/fakes', 'POST', function(data) {
                window.location.reload();
            }, json);
        } else {
            request('/fakes/' + id, 'PUT', function(data) {
                window.location.reload();
            }, json);
        }
    };

    var format = function() {
        $("#data").val(FormatTextarea($("#data").val()));
    };

    var request = function(uri, type, callback, data) {
        $.ajax({
            contentType: 'application/json',
            url: uri,
            type: type,
            data: data,
            success: function(data){
                callback(data);
            },
            error: function(error){
                console.log(error);
                alert(error.responseJSON.message);
            }
        });
    };

</script>
</html>